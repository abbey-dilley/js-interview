/* js-interview 
*/var Game=function(){function a(){this.createRenderer(),this.createLoader()}return a.prototype.createRenderer=function(){this.renderer=AbstractRenderer.getInstance().initialise(new PIXI.Point(300,350))},a.prototype.createLoader=function(){this.loader=new Loader("xml/Config.xml"),this.loader.addEventListener(EventType.COMPLETE,this.handleLoadComplete,this),this.loader.load()},a.prototype.createModel=function(){this.model=new GameModel(this.loader.getConfig())},a.prototype.createController=function(){this.controller=new GameController(this.model)},a.prototype.createView=function(){this.view=new GameView(this.model),this.renderer.addChild(this.view)},a.prototype.handleLoadComplete=function(){this.createModel(),this.createController(),this.createView()},a}(),GameController=function(){function a(a){this.model=a,this.create(),this.addEventListeners()}return a.prototype.create=function(){this.createEventBus()},a.prototype.createEventBus=function(){this.eventBus=EventBus.getInstance()},a.prototype.addEventListeners=function(){this.listen(EnemyShipEvent.DEAD,this.handleEnemyShipDead,this),this.listen(PlayerShipEvent.DEAD,this.handlePlayerShipDead,this)},a.prototype.handleEnemyShipDead=function(a){this.model.enemyShipDead(),this.model.updateScore(1),this.dispatchEvent(new PlayerScoreUpdatedEvent),0==this.model.getEnemiesLeft()&&this.dispatchEvent(new GameOverEvent(GameOverEvent.WIN))},a.prototype.handlePlayerShipDead=function(a){this.model.playerShipDead(),this.dispatchEvent(new PlayerLivesUpdatedEvent),0==this.model.getNumLives()&&this.dispatchEvent(new GameOverEvent(GameOverEvent.LOSE))},a.prototype.listen=function(a,b,c){this.eventBus.addEventListener(a,b,c)},a.prototype.remove=function(a,b){this.eventBus.removeEventListener(a,b)},a.prototype.dispatchEvent=function(a){this.eventBus.dispatchEvent(a)},a}(),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},GameOverEvent=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.WIN="GameOverEvent.WIN",b.LOSE="GameOverEvent.LOSE",b}(EventObject),PlayerLivesUpdatedEvent=function(a){function b(){a.call(this,b.UPDATED)}return __extends(b,a),b.UPDATED="PlayerLivesUpdatedEvent.UPDATED",b}(EventObject),PlayerScoreUpdatedEvent=function(a){function b(){a.call(this,b.UPDATED)}return __extends(b,a),b.UPDATED="PlayerScoreUpdatedEvent.UPDATED",b}(EventObject),GameModel=function(){function a(a){this.config=a,this.reset()}return a.prototype.reset=function(){this.numEnemies=this.config.getNumEnemies(),this.numLives=this.config.getNumLives(),this.numShields=this.config.getNumShields(),this.enemiesLeft=this.config.getNumEnemies(),this.score=0},a.prototype.enemyShipDead=function(){this.enemiesLeft--},a.prototype.playerShipDead=function(){this.numLives--},a.prototype.updateScore=function(a){this.score+=a},a.prototype.getEnemiesLeft=function(){return this.enemiesLeft},a.prototype.getScore=function(){return this.score},a.prototype.getNumLives=function(){return this.numLives},a.prototype.getNumEnemies=function(){return this.numEnemies},a.prototype.getNumShields=function(){return this.numShields},a}(),AbstractView=function(a){function b(){a.call(this),this.create(),this.addEventListeners()}return __extends(b,a),b.prototype.create=function(){this.createEventBus(),this.createRenderer()},b.prototype.createRenderer=function(){this.renderer=AbstractRenderer.getInstance()},b.prototype.createEventBus=function(){this.eventBus=EventBus.getInstance()},b.prototype.listen=function(a,b,c){this.eventBus.addEventListener(a,b,c)},b.prototype.remove=function(a,b){this.eventBus.removeEventListener(a,b)},b.prototype.dispatch=function(a){this.eventBus.dispatchEvent(a)},b.prototype.addEventListeners=function(){},b.prototype.removeEventListeners=function(){},b}(PIXI.Container),GameView=function(a){function b(b){this.model=b,a.call(this)}return __extends(b,a),b.prototype.create=function(){a.prototype.create.call(this),this.createBackground(),this.createPlayerShip(),this.createEnemyShips(),this.createShields(),this.createFields()},b.prototype.addEventListeners=function(){this.listen(PlayerLivesUpdatedEvent.UPDATED,this.handlePlayerLivesUpdate,this),this.listen(PlayerScoreUpdatedEvent.UPDATED,this.handlePlayerScoreUpdate,this)},b.prototype.createBackground=function(){this.background=GraphicsUtil.createRectangle(this.renderer.getGameSize()),this.addChild(this.background)},b.prototype.createPlayerShip=function(){this.playerShip=new PlayerShip,this.addChild(this.playerShip)},b.prototype.createEnemyShips=function(){this.enemyShips=[];for(var a,b=0;b<this.model.getNumEnemies();b++)a=new EnemyShip,this.enemyShips.push(a),this.renderer.addChild(a)},b.prototype.createShields=function(){var a=new PIXI.Point(17,this.renderer.getGameSize().y-this.renderer.getGameSize().y/5);this.shields=[];for(var b,c=0;c<this.model.getNumShields();c++)b=new Shield,b.position=a,a=new PIXI.Point(a.x+this.renderer.getGameSize().x/this.model.getNumShields(),a.y),this.addChild(b),this.shields.push(b)},b.prototype.createFields=function(){this.createScoreLabel(),this.createScore(),this.createLivesLabel(),this.createLives(),this.createGameName()},b.prototype.createScoreLabel=function(){this.scoreLabel=new PIXI.extras.BitmapText("score",{font:Font.HELVETICA,align:"right"}),this.scoreLabel.position=new PIXI.Point(75,this.renderer.getGameSize().y-20),this.addChild(this.scoreLabel)},b.prototype.createScore=function(){this.score=new PIXI.extras.BitmapText(this.model.getScore().toString(),{font:Font.HELVETICA,align:"left"}),this.score.position=new PIXI.Point(115,this.renderer.getGameSize().y-20),this.addChild(this.score)},b.prototype.createLivesLabel=function(){this.livesLabel=new PIXI.extras.BitmapText("lives",{font:Font.HELVETICA,align:"right"}),this.livesLabel.position=new PIXI.Point(5,this.renderer.getGameSize().y-20),this.addChild(this.livesLabel)},b.prototype.createLives=function(){this.lives=new PIXI.extras.BitmapText(this.model.getNumLives().toString(),{font:Font.HELVETICA,align:"left"}),this.lives.position=new PIXI.Point(40,this.renderer.getGameSize().y-20),this.addChild(this.lives)},b.prototype.createGameName=function(){this.gameName=new PIXI.extras.BitmapText("spaceinvaders",{font:Font.HELVETICA,align:"right"}),this.gameName.position=new PIXI.Point(210,this.renderer.getGameSize().y-20),this.addChild(this.gameName)},b.prototype.handlePlayerScoreUpdate=function(a){this.score.text=this.model.getScore().toString()},b.prototype.handlePlayerLivesUpdate=function(a){this.lives.text=this.model.getNumLives().toString(),this.model.getNumLives()>0&&this.playerShip.revive()},b}(AbstractView),EnemyBullet=function(a){function b(b){a.call(this),this.sprite.position=b}return __extends(b,a),b.prototype.create=function(){a.prototype.create.call(this),this.createBullet()},b.prototype.dispose=function(){this.parent&&this.renderer.removeChild(this)},b.prototype.createBullet=function(){this.sprite=Style.getSprite(Style.ENEMY_BULLET),this.addChild(this.sprite)},b.prototype.fire=function(){this.renderer.addChild(this),this.tween=TweenMax.to(this.sprite.position,1,{y:this.renderer.getGameSize().y,ease:Linear.easeNone,onUpdate:ObjectUtil.delegate(this.handleTweenUpdate,this),onComplete:ObjectUtil.delegate(this.handleTweenComplete,this)})},b.prototype.handleTweenUpdate=function(){this.dispatch(new EnemyBulletEvent(this))},b.prototype.handleTweenComplete=function(){this.dispose()},b.prototype.getSprite=function(){return this.sprite},b}(AbstractView),EnemyShip=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.create=function(){a.prototype.create.call(this),this.createShip(),this.createTweens(),this.startMoveTimer(),this.startFireTimer()},b.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.moveTimer.removeEventListener(TimerEvent.TIMER,this),this.fireTimer.removeEventListener(TimerEvent.TIMER,this),this.remove(PlayerBulletEvent.MOVE,this),this.dispatch(new EnemyShipEvent)},b.prototype.addEventListeners=function(){this.listen(PlayerBulletEvent.MOVE,this.handlePlayerBullet,this)},b.prototype.createShip=function(){this.ship=Style.getMovieClip(Style.ENEMY_SHIP),this.ship.play(),this.addChild(this.ship)},b.prototype.createTweens=function(){this.tweens=new Dictionary},b.prototype.startMoveTimer=function(){this.moveTimer=new Timer(1e3),this.moveTimer.addEventListener(TimerEvent.TIMER,this.handleMoveTimerUpdate,this),this.moveTimer.start()},b.prototype.startFireTimer=function(){this.fireTimer=new Timer(1500),this.fireTimer.addEventListener(TimerEvent.TIMER,this.handleFireTimeUpdate,this),this.fireTimer.start()},b.prototype.handleMoveTimerUpdate=function(a){this.move(this.randomPoint)},b.prototype.handleFireTimeUpdate=function(a){new EnemyBullet(this.ship.position.clone()).fire()},b.prototype.handlePlayerBullet=function(a){GraphicsUtil.isInBounds(this.ship,a.getBullet().getSprite())&&this.dispose()},b.prototype.move=function(a){this.tweens.setValue("x",TweenMax.to(this.ship.position,1,{x:a.x,ease:Linear.easeIn})),this.tweens.setValue("y",TweenMax.to(this.ship.position,1,{y:a.y,ease:Linear.easeIn}))},Object.defineProperty(b.prototype,"randomPoint",{get:function(){var a=Math.random()*(this.renderer.getGameSize().x-this.ship.width),b=Math.random()*(this.renderer.getGameSize().y-this.ship.height-150);return new PIXI.Point(a,b)},enumerable:!0,configurable:!0}),b}(AbstractView),PlayerBullet=function(a){function b(b){a.call(this),this.sprite.position=b}return __extends(b,a),b.prototype.create=function(){a.prototype.create.call(this),this.createBullet()},b.prototype.dispose=function(){this.parent&&this.renderer.removeChild(this)},b.prototype.createBullet=function(){this.sprite=Style.getSprite(Style.PLAYER_BULLET),this.addChild(this.sprite)},b.prototype.fire=function(){this.renderer.addChild(this),this.tween=TweenMax.to(this.sprite.position,1,{y:0,ease:Linear.easeNone,onUpdate:ObjectUtil.delegate(this.handleTweenUpdate,this),onComplete:ObjectUtil.delegate(this.handleTweenComplete,this)})},b.prototype.handleTweenUpdate=function(){this.dispatch(new PlayerBulletEvent(this))},b.prototype.handleTweenComplete=function(){this.dispose()},b.prototype.getSprite=function(){return this.sprite},b}(AbstractView),PlayerShip=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.create=function(){a.prototype.create.call(this),this.createShip()},b.prototype.createShip=function(){this.ship=Style.getSprite(Style.PLAYER_SHIP),this.ship.interactive=!0,this.addChild(this.ship),this.ship.position=new PIXI.Point(125,this.renderer.getGameSize().y-this.renderer.getGameSize().y/8)},b.prototype.dispose=function(){this.ship.parent&&this.removeChild(this.ship),this.removeEventListeners(),this.dispatch(new PlayerShipEvent)},b.prototype.addEventListeners=function(){var a=this.renderer.getStage();MouseUtil.setInteractive(a,!0),MouseUtil.addMouseMove(a,this.handleMouseMove,this),MouseUtil.addMouseDown(a,this.handleMouseDown,this),this.listen(EnemyBulletEvent.MOVE,this.handleEnemyBulletMove,this)},b.prototype.removeEventListeners=function(){var a=this.renderer.getStage();MouseUtil.removeMouseMove(a,this.handleMouseMove),MouseUtil.removeMouseDown(a,this.handleMouseDown),this.remove(EnemyBulletEvent.MOVE,this)},b.prototype.handleMouseDown=function(){var a=this.ship.position.x+this.ship.width/2,b=this.ship.position.y,c=new PIXI.Point(a,b);new PlayerBullet(c).fire()},b.prototype.handleMouseMove=function(a){Logger.debug("Handle Mouse Move");var b=a.data;this.ship.position=new PIXI.Point(b.global.x,this.ship.position.y)},b.prototype.handleEnemyBulletMove=function(a){GraphicsUtil.isInBounds(this.ship,a.getBullet().getSprite())&&this.dispose()},b.prototype.revive=function(){var a=this.renderer.getStage();MouseUtil.setInteractive(a,!0),MouseUtil.addMouseMove(a,this.handleMouseMove,this),MouseUtil.addMouseDown(a,this.handleMouseDown,this),this.startFlashTimer(),this.addChild(this.ship)},b.prototype.startFlashTimer=function(){var a=new Timer(300,5);a.addEventListener(TimerEvent.TIMER,this.handleFlashTimerUpdate,this),a.addEventListener(TimerEvent.COMPLETE,this.handleFlashTimerComplete,this),a.start()},b.prototype.handleFlashTimerUpdate=function(a){this.ship.visible=!this.ship.visible},b.prototype.handleFlashTimerComplete=function(a){this.ship.visible=!0,this.listen(EnemyBulletEvent.MOVE,this.handleEnemyBulletMove,this)},b}(AbstractView),Shield=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.create=function(){a.prototype.create.call(this),this.createBlocks()},b.prototype.addEventListeners=function(){this.listen(PlayerBulletEvent.MOVE,this.handlePlayerBulletMove,this),this.listen(EnemyBulletEvent.MOVE,this.handleEnemyBulletMove,this)},b.prototype.createBlocks=function(){this.blocks=[];for(var a=0;a<b.STRUCTURE.length;a++)for(var c,d=b.STRUCTURE[a],e=d.x;e<d.y;e++)c=this.createBlock(e,a),this.addChild(c),this.blocks.push(c)},b.prototype.createBlock=function(a,b){var c=Style.getSprite(Style.SHIELD);return c.position=new PIXI.Point(a*c.width,b*c.height),c},b.prototype.handlePlayerBulletMove=function(a){var b=a.getBullet(),c=this.checkBlockBounds(b.getSprite());c&&(c.visible=!1,b.dispose())},b.prototype.handleEnemyBulletMove=function(a){var b=a.getBullet(),c=this.checkBlockBounds(b.getSprite());c&&(c.visible=!1,b.dispose())},b.prototype.checkBlockBounds=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];if(c.visible&&GraphicsUtil.isInBounds(c,a))return c}return null},b.STRUCTURE=[new PIXI.Point(0,10),new PIXI.Point(1,9),new PIXI.Point(2,8)],b}(AbstractView),EnemyBulletEvent=function(a){function b(c){a.call(this,b.MOVE),this.bullet=c}return __extends(b,a),b.prototype.getBullet=function(){return this.bullet},b.MOVE="EnemyBulletEvent.MOVE",b}(EventObject),EnemyShipEvent=function(a){function b(){a.call(this,b.DEAD)}return __extends(b,a),b.DEAD="EnemyShipEvent.DEAD",b}(EventObject),PlayerBulletEvent=function(a){function b(c){a.call(this,b.MOVE),this.bullet=c}return __extends(b,a),b.prototype.getBullet=function(){return this.bullet},b.MOVE="PlayerBulletEvent.MOVE",b}(EventObject),PlayerShipEvent=function(a){function b(){a.call(this,b.DEAD)}return __extends(b,a),b.DEAD="PlayerShipEvent.DEAD",b}(EventObject),Font=function(){function a(){}return a.HELVETICA="12px Helvetica",a}(),Style=function(){function a(){}return a.addPath=function(b){a.map[b.id]=b},a.getPath=function(b){return a.map[b]},a.getSprite=function(a){var b=this.getPath(a);return PIXI.Sprite.fromImage(b.url)},a.getMovieClip=function(b){for(var c=this.getPath(b),d=[],e=0;e<c.frames;e++){var f=PIXI.Texture.fromFrame(c.id+a.formatTexture(e));d.push(f)}return new PIXI.extras.MovieClip(d)},a.formatTexture=function(a){for(var b=a.toString();b.length<4;)b="0"+b;return b},a.PLAYER_SHIP="PlayerShip",a.PLAYER_BULLET="PlayerBullet",a.ENEMY_SHIP="EnemyShip",a.ENEMY_BULLET="EnemyBullet",a.SHIELD="Shield",a.map=new Dictionary,a}(),Loader=function(a){function b(b){a.call(this),this.url=b}return __extends(b,a),b.prototype.load=function(){var a=new ConfigRequest(this.url);a.addEventListener(EventType.COMPLETE,this.handleConfigComplete,this),a.load()},b.prototype.handleConfigComplete=function(a){var b=a.currentTarget;this.config=b.getConfig();for(var c,d=b.getConfig().getFiles(),e=d.getValues(),f=[],g=0;g<e.length;g++)c=e[g],f.push(c.url),Style.addPath(c);this.loader=new PIXI.loaders.Loader,this.loader.add(f),this.loader.once("complete",ObjectUtil.delegate(this.handleFilesComplete,this)),this.loader.load()},b.prototype.handleFilesComplete=function(){this.dispatchEvent(new EventObject(EventType.COMPLETE))},b.prototype.getConfig=function(){return this.config},b}(EventDispatcher),ConfigData=function(){function a(a){this.document=a,this.numShields=parseInt($(a).find("NumShields").text()),this.numEnemies=parseInt($(a).find("NumEnemies").text()),this.numLives=parseInt($(a).find("NumLives").text()),this.enemySpeed=parseInt($(a).find("EnemySpeed").text()),this.processFiles()}return a.prototype.processFiles=function(){this.files=new Dictionary;var a=$(this.document).find("Files"),b=a.children();b.each(ObjectUtil.delegate(this.processFile,this))},a.prototype.processFile=function(a,b){var c=b.nodeName,d=b.getAttribute("id"),e=ObjectUtil.reflect(window,c+FilePath.PREFIX,b);this.files.setValue(d,e)},a.prototype.getNumEnemies=function(){return this.numEnemies},a.prototype.getEnemySpeed=function(){return this.enemySpeed},a.prototype.getNumLives=function(){return this.numLives},a.prototype.getNumShields=function(){return this.numShields},a.prototype.getFiles=function(){return this.files},a}(),ConfigRequest=function(a){function b(b){a.call(this),this.url=b}return __extends(b,a),b.prototype.load=function(){$.get(this.url,null,ObjectUtil.delegate(this.handleConfigComplete,this),"xml")},b.prototype.handleConfigComplete=function(a){this.config=new ConfigData(a),this.dispatchEvent(new EventObject(EventType.COMPLETE,this))},b.prototype.getConfig=function(){return this.config},b}(EventDispatcher);